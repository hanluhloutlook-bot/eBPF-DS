# 版本管理与发布要求

## 版本号规则
- 采用语义化版本：`主版本.次版本.修订版本`。
- 当新增功能并保持兼容时，提升次版本号。
- 当修复问题且不影响功能时，提升修订版本号。

## 强制发布要求（必须遵守）
1. **云下部署支持**：本次新增云下部署支持，版本必须升级为 **1.1.0**。
2. **镜像导出要求**：
   - 若要求导出镜像，必须进行**分割压缩**。
   - **每个分片不超过 15MB**。
   - **压缩格式必须为 Windows 可解析格式（ZIP 分卷）**。
3. **云下运行包导出要求**：
   - 若要求导出云下运行所需文件（JAR/eBPF/update_map/config/entrypoint），必须进行**分割压缩**。
   - **每个分片不超过 15MB**。
   - **压缩格式必须为 Windows 可解析格式（ZIP 分卷）**。

## 版本变更记录

### 1.1.9
**发布日期**：2026-02-06

**变更摘要**：
- 增加策略缓存调试查询与日志，便于定位删除不生效问题。

**详细变更**：
- **缓存查询**：新增 `/api/networkpolicy/cache` 返回缓存摘要（仅调试）。
- **日志增强**：策略创建/删除时输出缓存摘要，便于排查缓存未清空。

---

### 1.1.8
**发布日期**：2026-02-05

**变更摘要**：
- 策略删除校验与失败提示更准确。

**详细变更**：
- **删除校验**：删除策略时校验 `namespace/name` 必填并在未找到策略时返回错误。
- **失败返回**：无法访问 K8s API 或获取本节点 Pod 失败时返回错误，避免静默成功。

---

### 1.1.7
**发布日期**：2026-02-05

**变更摘要**：
- 修复重启后残留规则导致删除无效的问题。

**详细变更**：
- **规则清理**：当内存态规则为空时先清空内核 map，再下发期望规则。

---

### 1.1.6
**发布日期**：2026-02-05

**变更摘要**：
- 策略下发结果与实际执行一致。

**详细变更**：
- **接口返回**：当规则下发/清理失败时返回错误，不再统一返回 success。

---

### 1.1.5
**发布日期**：2026-02-05

**变更摘要**：
- 增强删除策略后的规则清理兜底逻辑。

**详细变更**：
- **策略删除**：当策略缓存为空时，读取 map 并逐条删除规则，避免残留。

---

### 1.1.4
**发布日期**：2026-02-05

**变更摘要**：
- 修复删除策略后规则未清理的问题。

**详细变更**：
- **策略删除**：当策略缓存为空时，清理已下发规则与白名单模式，避免残留。

---

### 1.1.3
**发布日期**：2026-02-05

**变更摘要**：
- 增加 tunl0 挂载以覆盖 IPIP 隧道流量。

**详细变更**：
- **网卡挂载**：增加 `tunl0` 的 tc 挂载，支持 Calico IPIP 隧道场景。

---

### 1.1.2
**发布日期**：2026-02-05

**变更摘要**：
- 修复 `update_map` 返回码导致的误报启动失败。

**详细变更**：
- **启动返回码**：成功执行后返回 0，避免 `eBPF auto start failed` 误告警。

---

### 1.1.1
**发布日期**：2026-02-05

**变更摘要**：
- 修复 CIDR map 已存在导致启动失败的问题。

**详细变更**：
- **eBPF 启动**：当 pin 路径已存在时自动清理并重新 pin，避免 `file exists` 报错。

---

### 1.1.0
**发布日期**：2026-02-05

**变更摘要**：
- 新增云下部署支持（通过 `SIMPLIFIED_MODE` 环境变量控制）。
- 规则能力增强与适配更新。
- API 文档与接口参数统一为 body 传参。

**详细变更**：
- **云下部署**：支持在无 K8s 环境运行，提供 systemd 配置示例。
- **策略目标**：新增 `targetObject.type=namespace`，对命名空间内所有负载及其 Service 生效。
- **CIDR 支持**：规则可配置 CIDR，使用 LPM_TRIE 匹配。
- **端口通配**：规则端口 `0` 表示所有端口。
- **接口调整**：`add-rule`、`delete-rule`、`start-ebpf`、`stop-ebpf`、`delete` 统一使用 body 传参。
- **文档完善**：接口参数必填/可选、枚举含义与示例完整对齐。

---

> 说明：后续每次发布必须在此文档补充版本号与变更内容，并遵循“镜像导出要求”。
